---
import Header from '../../../src/components/Header.astro';
import Footer from '../../../src/components/Footer.astro';
---

<Header />

<h1>Créer un événement</h1>

<form id="event-form" enctype="multipart/form-data">
    <label>Nom :
        <input type="text" name="nom" required />
    </label><br />

    <label>Description :
        <textarea name="description" required></textarea>
    </label><br />

    <label>Horaire :
        <input type="datetime-local" name="horaire" required />
    </label><br />

    <label>Lieu :
        <input type="text" name="lieu" required />
    </label><br />

    <label>Organisateur :
        <input type="text" name="organisateur" required />
    </label><br />

    <label>Participants max :
        <input type="number" name="Participants_max" required />
    </label><br />

    <label>Prix :
        <input type="text" name="prix" required />
    </label><br />

    <label>Snippet :
        <input type="text" name="snippet" required />
    </label><br />

    <label>Catégorie :
        <input type="text" name="categorie" required />
    </label><br />

    <label>Inscription :
        <select name="inscription">
            <option>Avec inscription</option>
            <option>Sans inscription</option>
        </select>
    </label><br />

    <label>Image :
        <input type="file" name="image" accept="image/*" required />
    </label><br />

    <button type="submit">Créer l'événement</button>
</form>

<p id="message"></p>

<Footer />

<script type="module">
    const form = document.querySelector('#event-form');
    const message = document.querySelector('#message');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        message.textContent = '';

        const formData = new FormData(form);

        try {
            const response = await fetch('/api/ajout-evenement', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();
            console.log('[Résultat API]', JSON.stringify(result, null, 2));

            if (result.success) {
                message.textContent = 'Événement créé avec succès.';
                form.reset();
                setTimeout(() => {
                    window.location.href = '/connecte';
                }, 1000);
            } else {
                message.textContent = 'Erreur : ' + result.message;
            }
        } catch (error) {
            console.error('Erreur de requête :', error);
            message.textContent = 'Erreur de connexion au serveur.';
        }
    });
</script>
